<?xml version="1.0"?>

<launch>
    <arg name="camera" default="camera" />

    <!-- Realsense Camera -->
    <include
        file="$(find realsense2_camera)/launch/rs_camera.launch">
        <arg name="align_depth" value="true"/>
        <arg name="linear_accel_cov" value="0.5"/>
        <arg name="unite_imu_method" value="linear_interpolation"/>
    </include>

    <!-- IMU Filter Node -->
    <node pkg="imu_filter_madgwick" type="imu_filter_node" name="ImuFilter">
        <param name="fixed_frame" type="string" value="camera_link"/>
        <param name="use_mag" type="bool" value="false" />
        <param name="_publish_tf" type="bool" value="true" />
        <param name="_world_frame" type="string" value="nwu" />
        <remap from="/imu/data_raw" to="/camera/imu"/>
    </node>

    <!-- Laserscan Node -->
    <node pkg="depthimage_to_laserscan" type="depthimage_to_laserscan" name="depthimage_to_laserscan">
        <remap from="image" to="$(arg camera)/depth/image_rect_raw"/>
        <remap from="scan" to="/scan"/>
        <rosparam>
            output_frame_id: base_laser # Leave disabled to output scan in pointcloud frame
            transform_tolerance: 0.01
            scan_height: 1
            scan_time: 0.03333
            range_min: 0.45
            range_max: 10.0
        </rosparam>
    </node>

    <!-- ORB SLAM Odometry -->
    <include file="$(find orb_slam2_ros)/ros/launch/orb_slam2_d435i_rgbd.launch" />

    <node pkg="mobile_robot_odom" type="odom_trashbot" name="odom_trashbot" />

    <!-- Robot Localization Node
    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se" clear_params="true" >
	    <rosparam file="$(find mobile_robot_2dnav)/param/ekf.yaml" command="load" />
    </node> -->
    
  
    <!-- TF Setup Node -->
    <node pkg="mobile_robot_setup_tf" type="tf_robot" name="tf_robot" />

    <!-- RVIZ -->
    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find mobile_robot_2dnav)/rviz/slam.rviz" />

  
</launch>
